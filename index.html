<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒˆãƒªãƒŸãƒ³ã‚°ä»®äºˆç´„</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; color: #333; }
    h2 { text-align: center; color: #00b900; margin-top: 0; margin-bottom: 10px; }
    .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
    label { display: block; margin-top: 15px; margin-bottom: 5px; font-weight: bold; font-size: 14px; color: #555; }
    input[type="text"], input[type="tel"], textarea, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; -webkit-appearance: none; background-color: #fff; }
    textarea { height: 100px; resize: vertical; line-height: 1.5; }
    
    /* ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãƒ»ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .radio-group, .checkbox-group { margin-top: 5px; }
    .radio-label, .checkbox-label { display: block; padding: 10px; border-bottom: 1px solid #eee; font-size: 16px; cursor: pointer; }
    .radio-label:last-child, .checkbox-label:last-child { border-bottom: none; }
    .radio-label input, .checkbox-label input { margin-right: 10px; transform: scale(1.2); }

    .date-display { display: flex; gap: 10px; margin-bottom: 10px; }
    .date-box { flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; text-align: center; background: #fafafa; cursor: pointer; }
    .date-box.active { border-color: #00b900; background: #e6f9e6; color: #00b900; font-weight: bold; }
    .date-box span { display: block; font-size: 12px; color: #888; margin-bottom: 4px; }
    .date-box div { font-size: 16px; font-weight: bold; }
    .calendar-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    .calendar-table th { color: #888; font-size: 12px; padding-bottom: 5px; }
    .calendar-table td { text-align: center; padding: 8px 0; cursor: pointer; border-radius: 4px; font-weight: bold; font-size: 14px; }
    .day-cell:hover { background-color: #f0f0f0; }
    .day-cell.disabled { color: #ccc; pointer-events: none; text-decoration: line-through; background-color: #f9f9f9; }
    .day-cell.selected-1 { background-color: #00b900; color: white; border-radius: 50%; }
    .day-cell.selected-2 { background-color: #0084b9; color: white; border-radius: 50%; }
    button { width: 100%; padding: 16px; margin-top: 20px; background-color: #00b900; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; transition: background 0.2s; }
    button:active { background-color: #009900; }
    button:disabled { background-color: #ccc; cursor: not-allowed; }
    #complete-area { display: none; text-align: center; padding: 40px 20px; }
    .check-icon { font-size: 60px; color: #00b900; margin-bottom: 20px; }
    .important-msg { background-color: #fff4f4; border: 2px solid #ffcccc; border-radius: 8px; padding: 15px; color: #d32f2f; font-weight: bold; line-height: 1.6; margin-top: 20px; }
    #login-area { display: block; margin-bottom: 20px; text-align: center; }
    .login-link-btn { display: block; background-color: #06C755; color: white; font-weight: bold; font-size: 16px; padding: 15px; border-radius: 8px; text-decoration: none; width: 100%; box-sizing: border-box; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .notice-box { background-color: #fff9e6; border: 1px solid #ffcc00; border-radius: 8px; padding: 15px; margin-bottom: 20px; font-size: 13px; line-height: 1.6; color: #555; }
    #status-bar { background-color: #ffcccc; color: #d32f2f; padding: 10px; text-align: center; font-size: 14px; font-weight: bold; border-radius: 5px; margin-bottom: 15px; }
    #status-bar.connected { background-color: #e6f9e6; color: #00b900; }
  </style>
</head>
<body>
  <div id="form-area">
    <h2>ãƒˆãƒªãƒŸãƒ³ã‚°ä»®äºˆç´„</h2>
    <div id="status-bar">ğŸ”´ LINEæœªé€£æºï¼ˆé€šçŸ¥ãŒå±Šãã¾ã›ã‚“ï¼‰</div>
    <div id="login-area">
      <div style="font-size:13px;color:#666;margin-bottom:5px;">â–¼ äºˆç´„ã®æ§ãˆã‚’å—ã‘å–ã‚‹ã«ã¯é€£æºã—ã¦ãã ã•ã„ â–¼</div>
      <a href="https://liff.line.me/2008780635-CFUcjozG" target="_top" class="login-link-btn">LINEé€£æºã™ã‚‹ (ãƒªãƒ­ãƒ¼ãƒ‰)</a>
    </div>
    <div class="notice-box">
      ãƒˆãƒªãƒŸãƒ³ã‚°ã®äºˆç´„ã«ã¯ã€å½“é™¢ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã€<a href="https://www.emu-vet.jp/trimming/" target="_blank">ãƒˆãƒªãƒŸãƒ³ã‚°ãƒšãƒ¼ã‚¸</a>ã®æ³¨æ„äº‹é …ã‚’ã‚ˆããŠèª­ã¿ãã ã•ã„ã€‚<br>
      å½“é™¢ã®è¨ºå¯Ÿåˆ¸ã‚’ãŠæŒã¡ã§ãªã„å ´åˆã¯ãŠé›»è©±ï¼ˆ<a href="tel:0474587557">047-458-7557</a>ï¼‰ã«ã¦ã”é€£çµ¡ãã ã•ã„ã€‚
    </div>
    
    <div class="card">
      <label>è¨ºå¯Ÿåˆ¸ç•ªå· (æ•°å­—ã®ã¿)</label>
      <input type="tel" id="cardNo" placeholder="ä¾‹ï¼š12345">
      <label>é£¼ä¸»æ§˜ãŠåå‰</label>
      <input type="text" id="ownerName" placeholder="é£¼ã„ä¸»æ§˜ã®ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
      <label>ãƒšãƒƒãƒˆå</label>
      <input type="text" id="petName" placeholder="ä¾‹ï¼šãƒãƒ">
    </div>

    <!-- â–¼â–¼â–¼ ä¿®æ­£éƒ¨åˆ†ï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ»ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ â–¼â–¼â–¼ -->
    <div class="card">
      <label style="margin-top:0;">ãƒˆãƒªãƒŸãƒ³ã‚°å†…å®¹</label>
      <div class="radio-group">
        <label class="radio-label"><input type="radio" name="menu" value="ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼" checked> ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼</label>
        <label class="radio-label"><input type="radio" name="menu" value="ã‚«ãƒƒãƒˆ"> ã‚«ãƒƒãƒˆ</label>
      </div>

      <label>ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ã®ç¨®é¡ï¼ˆä»»æ„ï¼‰</label>
      <select id="shampoo">
        <option value="">æŒ‡å®šãªã—</option>
        <option value="EFAã‚·ãƒ£ãƒ³ãƒ—ãƒ¼">EFAã‚·ãƒ£ãƒ³ãƒ—ãƒ¼</option>
        <option value="ã‚«ã‚·ãƒŸãƒ¤ã‚¿ãƒƒãƒã‚·ãƒ£ãƒ³ãƒ—ãƒ¼">ã‚«ã‚·ãƒŸãƒ¤ã‚¿ãƒƒãƒã‚·ãƒ£ãƒ³ãƒ—ãƒ¼</option>
        <option value="ã‚»ãƒ©ãƒŸãƒ‰ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼">ã‚»ãƒ©ãƒŸãƒ‰ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼</option>
      </select>

      <label>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</label>
      <div class="checkbox-group">
        <label class="checkbox-label"><input type="checkbox" name="option" value="ã¾ã—ã‚…ã¾ã‚æ³¡ãƒ‘ãƒƒã‚¯"> ã¾ã—ã‚…ã¾ã‚æ³¡ãƒ‘ãƒƒã‚¯</label>
        <label class="checkbox-label"><input type="checkbox" name="option" value="ãƒãƒ¼ãƒ–ãƒ‘ãƒƒã‚¯ï¼‹ãƒãƒ¼ãƒ–æ¹¯"> ãƒãƒ¼ãƒ–ãƒ‘ãƒƒã‚¯ï¼‹ãƒãƒ¼ãƒ–æ¹¯</label>
        <label class="checkbox-label"><input type="checkbox" name="option" value="ãƒ€ãƒ¼ãƒãƒ¢ã‚¤ã‚¹ãƒˆãƒã‚¹"> ãƒ€ãƒ¼ãƒãƒ¢ã‚¤ã‚¹ãƒˆãƒã‚¹</label>
        <label class="checkbox-label"><input type="checkbox" name="option" value="è–¬æµ´"> è–¬æµ´</label>
      </div>
    </div>
    <!-- â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–² -->

    <div class="card">
      <label style="margin-top:0;">å¸Œæœ›æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
      <p style="font-size:12px; color:#666; margin-bottom:15px;">æ°´ãƒ»æ—¥ãƒ»ç¥æ—¥ã¯ä¼‘è¨ºã§ã™ã€‚<br><span style="color:#00b900;">â– ç·‘ï¼ç¬¬1å¸Œæœ›</span> / <span style="color:#0084b9;">â– é’ï¼ç¬¬2å¸Œæœ›</span></p>
      <div class="date-display">
        <div class="date-box active" id="box-1" onclick="setMode(1)"><span>ç¬¬1å¸Œæœ›</span><div id="disp-date1">æœªé¸æŠ</div></div>
        <div class="date-box" id="box-2" onclick="setMode(2)"><span>ç¬¬2å¸Œæœ›</span><div id="disp-date2">æœªé¸æŠ</div></div>
      </div>
      <input type="hidden" id="val-date1"><input type="hidden" id="val-date2">
      <div id="calendar-container">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>
    <div class="card">
      <label style="margin-top:0;">ãã®ä»–ï¼ˆè¨ºå¯Ÿãƒ»ã”è¦æœ›ï¼‰</label>
      <textarea id="note" placeholder="ä¾‹ï¼šè€³ã®æ±šã‚ŒãŒæ°—ã«ãªã‚‹ã€ãƒ¯ã‚¯ãƒãƒ³å¸Œæœ›ãªã©"></textarea>
    </div>
    <button id="btn" onclick="submitReservation()">äºˆç´„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡</button>
  </div>

  <div id="complete-area" class="card">
    <div class="check-icon">âœ”</div>
    <h3>é€ä¿¡å®Œäº†</h3>
    <p>äºˆç´„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚</p>
    <div class="important-msg">ã¾ã äºˆç´„ã¯ç¢ºå®šã—ã¦ã„ã¾ã›ã‚“ã€‚<br>ç—…é™¢ã§ç¢ºèªå¾Œã€LINEã«ã¦<br><span style="font-size:1.2em; text-decoration:underline;">äºˆç´„ç¢ºå®šã®ã”é€£çµ¡</span>ã‚’ã„ãŸã—ã¾ã™ã€‚</div>
    <div style="margin-top:40px;font-weight:bold;background:#eee;padding:20px;border-radius:8px;">ç”»é¢å³ä¸Šã®ã€ŒÃ—ã€ãƒœã‚¿ãƒ³ã§<br>ç”»é¢ã‚’é–‰ã˜ã¦ãã ã•ã„</div>
  </div>

  <script>
    // â–¼â–¼â–¼ã“ã“ã«GASã®URLâ–¼â–¼â–¼
    const gasApiUrl = "https://script.google.com/macros/s/AKfycbxFyNZqwMI8M_IaesWwWxu5PjZSLXoLwgdPVuXT1QXBTxFB-i4fbRKrzf5Z0G8Rl8VV/exec"; 
    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    const myLiffId = '2008780635-CFUcjozG'; 
    let currentMode = 1;
    let blockedDates = [];
    let myAccessToken = ""; 

    window.onload = function() {
      fetch(gasApiUrl + "?action=getBlockDates")
        .then(res => res.json())
        .then(data => { blockedDates = data; renderCalendars(); })
        .catch(err => { console.error(err); renderCalendars(); });

      liff.init({ liffId: myLiffId }).then(() => {
        if (liff.isLoggedIn()) {
          myAccessToken = liff.getAccessToken();
          updateStatusToConnected();
        }
      });
    };

    function updateStatusToConnected() {
      document.getElementById('status-bar').innerText = "ğŸŸ¢ LINEé€£æºæ¸ˆã¿ï¼ˆé€šçŸ¥ãŒå±Šãã¾ã™ï¼‰";
      document.getElementById('status-bar').className = "connected";
      document.getElementById('login-area').style.display = 'none';
    }

    function renderCalendars() {
      const container = document.getElementById('calendar-container');
      container.innerHTML = "";
      const today = new Date();
      for (let i = 0; i < 2; i++) {
        const targetDate = new Date(today.getFullYear(), today.getMonth() + i, 1);
        container.innerHTML += createMonthHTML(targetDate.getFullYear(), targetDate.getMonth());
      }
    }
    function createMonthHTML(year, month) {
      const monthNames = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      let html = `<div style="text-align:center;font-weight:bold;margin:15px 0 10px;">${year}å¹´ ${monthNames[month]}</div>`;
      html += `<table class="calendar-table"><thead><tr><th style="color:red">æ—¥</th><th>æœˆ</th><th>ç«</th><th>æ°´</th><th>æœ¨</th><th>é‡‘</th><th style="color:blue">åœŸ</th></tr></thead><tbody><tr>`;
      for (let i = 0; i < firstDay.getDay(); i++) { html += `<td></td>`; }
      for (let d = 1; d <= lastDay.getDate(); d++) {
        const currentCheck = new Date(year, month, d);
        if (currentCheck.getDay() === 0 && d !== 1) { html += `</tr><tr>`; }
        const dateStr = formatDate(currentCheck);
        let classes = "day-cell";
        let onClick = `selectDate('${dateStr}')`;
        const todayStr = formatDate(new Date());
        const dayOfWeek = currentCheck.getDay();
        if (dateStr < todayStr || dayOfWeek === 0 || dayOfWeek === 3 || blockedDates.includes(dateStr)) { classes += " disabled"; onClick = ""; }
        html += `<td class="${classes}" id="cell-${dateStr}" onclick="${onClick}">${d}</td>`;
      }
      html += `</tr></tbody></table>`;
      return html;
    }
    function selectDate(dateStr) {
      if (currentMode === 1) { document.getElementById('val-date1').value = dateStr; document.getElementById('disp-date1').innerText = dateStr; setMode(2); }
      else { document.getElementById('val-date2').value = dateStr; document.getElementById('disp-date2').innerText = dateStr; }
      updateCalendarStyles();
    }
    function setMode(mode) {
      currentMode = mode;
      document.getElementById('box-1').className = mode === 1 ? 'date-box active' : 'date-box';
      document.getElementById('box-2').className = mode === 2 ? 'date-box active' : 'date-box';
    }
    function updateCalendarStyles() {
      const cells = document.querySelectorAll('.day-cell');
      cells.forEach(c => { c.classList.remove('selected-1', 'selected-2'); });
      const d1 = document.getElementById('val-date1').value;
      const d2 = document.getElementById('val-date2').value;
      if (d1) { const el = document.getElementById('cell-' + d1); if (el) el.classList.add('selected-1'); }
      if (d2) { const el = document.getElementById('cell-' + d2); if (el) el.classList.add('selected-2'); }
    }
    
    function submitReservation() {
      if (!myAccessToken) { if(!confirm("ã€æ³¨æ„ã€‘\nLINEé€£æºãŒã§ãã¦ã„ãªã„ãŸã‚ã€äºˆç´„ã®æ§ãˆé€šçŸ¥ãŒå±Šãã¾ã›ã‚“ã€‚\n\nãã‚Œã§ã‚‚äºˆç´„ã‚’é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ")) return; }
      
      const cardNo = document.getElementById('cardNo').value;
      const ownerName = document.getElementById('ownerName').value;
      const petName = document.getElementById('petName').value;
      const date1 = document.getElementById('val-date1').value;
      const date2 = document.getElementById('val-date2').value;
      const note = document.getElementById('note').value;
      
      // ãƒ‡ãƒ¼ã‚¿å–å¾—
      const menu = document.querySelector('input[name="menu"]:checked').value;
      const shampoo = document.getElementById('shampoo').value;
      
      // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã®å–å¾—
      const optionEls = document.querySelectorAll('input[name="option"]:checked');
      // é¸æŠã•ã‚ŒãŸå€¤ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§çµåˆï¼ˆä¾‹: "ã¾ã—ã‚…ã¾ã‚æ³¡ãƒ‘ãƒƒã‚¯, è–¬æµ´"ï¼‰
      const options = Array.from(optionEls).map(el => el.value).join(', ');

      if (!cardNo || !ownerName || !petName || !date1) { alert("å¿…é ˆé …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚"); return; }
      
      const btn = document.getElementById('btn');
      btn.disabled = true;
      btn.innerText = "é€ä¿¡ä¸­...";

      const data = { 
        cardNo: cardNo, 
        ownerName: ownerName, 
        petName: petName, 
        menu: menu, 
        shampoo: shampoo,
        options: options, // è¿½åŠ 
        date1: date1, 
        date2: date2, 
        note: note, 
        accessToken: myAccessToken 
      };
      
      fetch(gasApiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain; charset=utf-8' },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(json => {
        if (json.status === 'success') {
          document.getElementById('form-area').style.display = 'none';
          document.getElementById('complete-area').style.display = 'block';
        } else {
          alert("ã‚¨ãƒ©ãƒ¼: " + json.message);
          btn.disabled = false;
        }
      })
      .catch(err => { alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼: " + err); btn.disabled = false; });
    }
    
    function formatDate(dt) {
      const y = dt.getFullYear();
      const m = ('00' + (dt.getMonth()+1)).slice(-2);
      const d = ('00' + dt.getDate()).slice(-2);
      return y + '-' + m + '-' + d;
    }
  </script>
</body>
</html>